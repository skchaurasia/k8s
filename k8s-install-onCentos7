On-Centos-v7
--------------------
Note - swap & SE-linux must be disabled
- required ports must be allowed if firewall is running
- vm config: master-4GB(RAM),2cpu and Nodes -2GB(RAM),1cpu
- each vm should have two NIC one NIC must be connected to internet and other one will be use for cluster communication

* Create repository for kubernetes and docker : [run on all three nodes]
wget -O /etc/yum.repos.d/docker-ce.repo  https://download.docker.com/linux/centos/docker-ce.repo

# vim /etc/yum.repos.d/kuber.repo  
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg

* Install Packages: [run on all nodes]
yum install docker-ce kubeadm kubectl kubelet

* start & enable service: [run on all three nodes]
systemctl enable --now docker; systemctl enable --now kubelet

* Add the iptables rule to sysctl.conf:[run on all three nodes]
echo "net.bridge.bridge-nf-call-iptables=1" | sudo tee -a /etc/sysctl.conf

* Enable iptables immediately:[run on all three nodes]
# sudo sysctl -p

* Open Ports in firewall: [Run only on the master]
firewall-cmd --permanent --add-service={http,https}
firewall-cmd --permanent --add-port=6443/tcp
firewall-cmd --permanent --add-port=2379-2380/tcp
firewall-cmd --permanent --add-port=10250-10255/tcp
firewall-cmd --reload; firewall-cmd --list-ports; firewall-cmd --list-services

* initialize the cluster: [Run only on the master]
kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=<yourprivate-Address>
		Note: Pod network can be anything

* Set up local kubeconfig:[Run only on the master]
mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config

* Apply flannel/weave network overlay:[Run only on the master]
kubectl apply -f "https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\n')"
		[or]
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
# 	
kubectl get nodes
kubectl get pods --all-namespaces or -A  (kube-system)

* Join the worker nodes to the cluster: [Run only Worker Nodes]
firewall-cmd --permanent --add-port=10250-12051/tcp
firewall-cmd --permanent --add-port=30000-32767/tcp
firewall-cmd --permanent --add-port=10255/tcp
firewall-cmd --reload; firewall-cmd --list-ports

* To Join the k8s cluster:
kubeadm join --token <token-id> --discovery-token-ca-cert-hash <hash-code> [your unique string from the kubeadm init command]

eg:
kubeadm join 10.0.2.4:6443 --token 0txacn.7rcg83z6db46idk7 --discovery-token-ca-cert-hash sha256:ad4b97e14d1141ab55e8c9f0fa7200403b3c12594d290479d494650d781fe553

* if we forget the token than will create new one using below command:
kubeadm token create--print-join-command

* Verify the worker nodes have joined the cluster successfully: [Run only on the master]
kubectl get nodes
kubect get pods -n kube-system
